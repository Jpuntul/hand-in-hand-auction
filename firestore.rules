rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Items list - Read-only for all users, write only for admin
    match /items_list/{itemId} {
      // Anyone can read items
      allow read: if true;
      
      // Only allow writes if you're authenticated (admin check would go here)
      // For now, allowing authenticated users to write for admin panel
      allow write: if request.auth != null;
    }
    
    // Bids - Users can read all, but only write their own
    match /bids/{bidId} {
      // Anyone can read bids to see current highest bid
      allow read: if true;
      
      // Allow creating/updating bids if request has valid user data
      allow create, update: if request.resource.data.keys().hasAll(['bid', 'bidder', 'email', 'phone', 'timestamp'])
                           && request.resource.data.bid is number
                           && request.resource.data.bid > 0
                           && request.resource.data.bidder is string
                           && request.resource.data.email is string
                           && request.resource.data.phone is string;
      
      // Don't allow deleting bids
      allow delete: if false;
    }
    
    // Bid history - Users can read all and create new entries
    match /history/{itemId}/entries/{entryId} {
      // Anyone can read bid history
      allow read: if true;
      
      // Allow creating history entries with valid data
      allow create: if request.resource.data.keys().hasAll(['bid', 'bidder', 'email', 'phone', 'timestamp'])
                    && request.resource.data.bid is number
                    && request.resource.data.bid > 0
                    && request.resource.data.bidder is string
                    && request.resource.data.email is string
                    && request.resource.data.phone is string;
      
      // Don't allow updating or deleting history entries
      allow update, delete: if false;
    }
    
    // User profiles (if you add this feature later)
    match /users/{userId} {
      // Users can read their own profile
      allow read: if request.auth != null && request.auth.uid == userId;
      
      // Users can create/update their own profile
      allow create, update: if request.auth != null && request.auth.uid == userId;
      
      // Don't allow deleting user profiles
      allow delete: if false;
    }
    
    // Admin collection (for admin-only data)
    match /admin/{document=**} {
      // Only authenticated users can read/write admin data
      // You should add proper admin role checking here
      allow read, write: if request.auth != null;
    }
    
    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
